{# automation/templates/eap/index.html #}
{% extends 'automation/base.html' %}
{% block title %}JF Metrics | EAP{% endblock %}

{% block content %}

  <div class="mb-6">
    <h1 class="flex items-center gap-2 text-xl font-semibold text-slate-800">
      Estrutura Analítica do Projeto (EAP)
    </h1>
    <p class="mt-1 text-sm text-slate-500">Marco → Atividade Geral → Atividade Específica</p>
  </div>

  {% if milestones %}
    <div class="space-y-4">
      {% for m in milestones %}
        <article class="rounded-2xl border border-slate-200/70 bg-white p-4 shadow-sm">
          {# começa FECHADO #}
          <details class="group">
            <summary class="flex cursor-pointer list-none items-center justify-between gap-3">
              <div class="min-w-0 flex items-center gap-2">
                <i data-lucide="flag" class="h-5 w-5 text-emerald-600 shrink-0"></i>
                <h2 class="truncate text-[16px] font-semibold leading-snug text-slate-800" title="{{ m.name }}">
                  {{ m.name }}
                </h2>
              </div>
              <div class="flex items-center gap-3 shrink-0">
                {% with c=m.num_generals|default:0 %}
                  <span class="text-xs text-slate-500">
                    {% if c == 1 %}
                      1 atividade geral
                    {% else %}
                      {{ c }} atividades gerais
                    {% endif %}
                  </span>
                {% endwith %}
                <i data-lucide="chevron-down" class="h-5 w-5 text-slate-400 transition duration-200 group-open:rotate-180"></i>
              </div>
            </summary>

            {# Atividades Gerais #}
            <div class="mt-3 space-y-2">
              {% for g in m.generals.all %}
                <div class="rounded-xl border border-slate-200/70 p-3">
                  {# começa FECHADO #}
                  <details class="group">
                    <summary class="flex cursor-pointer list-none items-center justify-between gap-3">
                      <div class="min-w-0 flex items-center gap-2">
                        <i data-lucide="layers" class="h-5 w-5 text-sky-600 shrink-0"></i>
                        <h3 class="truncate text-[15px] font-medium leading-snug text-slate-800" title="{{ g.name }}">
                          {{ g.name }}
                        </h3>
                      </div>
                      <div class="flex items-center gap-3 shrink-0">
                        {% with c=g.num_specifics|default:0 %}
                          <span class="text-xs text-slate-500">
                            {% if c == 1 %}
                              1 atividade específica
                            {% else %}
                              {{ c }} atividades específicas
                            {% endif %}
                          </span>
                        {% endwith %}
                        <i data-lucide="chevron-down" class="h-5 w-5 text-slate-400 transition duration-200 group-open:rotate-180"></i>
                      </div>
                    </summary>

                    {# Específicas #}
                    {% if g.specifics.all %}
                      <ul class="mt-3 space-y-1.5">
                        {% for s in g.specifics.all %}
                          <li class="flex items-start gap-2 rounded-lg border border-slate-200/60 bg-slate-50/50 px-3 py-2">
                            <i data-lucide="dot" class="mt-1 h-4 w-4 text-slate-400"></i>
                            <span class="text-sm text-slate-700" title="{{ s.name }}">{{ s.name }}</span>
                          </li>
                        {% endfor %}
                      </ul>
                    {% else %}
                      <div class="mt-3 rounded-lg border border-dashed border-slate-200 p-3 text-xs text-slate-500">
                        Nenhuma atividade específica.
                      </div>
                    {% endif %}
                  </details>
                </div>
              {% empty %}
                <div class="rounded-xl border border-dashed border-slate-200 p-4 text-sm text-slate-500">
                  Nenhuma atividade geral cadastrada para este marco.
                </div>
              {% endfor %}
            </div>
          </details>
        </article>
      {% endfor %}
    </div>
  {% else %}
    <div class="flex items-center justify-center gap-2 rounded-xl border border-dashed border-slate-200 p-8 text-slate-500">
      <i data-lucide="inbox" class="h-5 w-5"></i>
      Nenhum marco ativo na EAP.
    </div>
  {% endif %}

{% endblock %}
